<script lang="ts">
	import { page } from "$app/stores";
	import { createOnlineChessStateStore } from "$lib/stores/online-chess-store";
	import { getPlayingColor } from "$lib/util";
	import { get } from "svelte/store";
	import type { PageData } from "./$types";

    export let data: PageData;
    
</script>

<div class="mt-[7.5vh] flex flex-col gap-4">
    <h1>Welcome, {$page.data.session.user.user_metadata.user_name}</h1>
    <hr />
    <div class="flex flex-wrap w-full justify-between gap-4">
        <div class="flex flex-col gap-2 items-center">
            <h2>Play</h2>
            <div class="grid grid-cols-2 gap-4">
                <button class="card !bg-tertiary-300-600-token p-4 aspect-square flex flex-col justify-center items-center">
                    <svg class="w-8 h-8" viewBox="0 0 1024 1024"><path d="M512 85.333333C277.333333 85.333333 85.333333 277.333333 85.333333 512s192 426.666667 426.666667 426.666667 426.666667-192 426.666667-426.666667S746.666667 85.333333 512 85.333333z" fill="#7CB342" /><path d="M960 512c0 249.6-202.666667 448-448 448S64 761.6 64 512 262.4 64 512 64s448 198.4 448 448z m-452.266667 206.933333c0-8.533333-4.266667-12.8-12.8-17.066666-27.733333-8.533333-53.333333-8.533333-76.8-32-4.266667-8.533333-4.266667-17.066667-8.533333-27.733334-8.533333-8.533333-32-12.8-44.8-17.066666h-89.6c-12.8-4.266667-23.466667-23.466667-32-36.266667 0-4.266667 0-12.8-8.533333-12.8-8.533333-4.266667-17.066667 4.266667-27.733334 0-4.266667-4.266667-4.266667-8.533333-4.266666-12.8 0-12.8 8.533333-27.733333 17.066666-36.266667 12.8-8.533333 27.733333 4.266667 40.533334 4.266667 4.266667 0 4.266667 0 8.533333 4.266667 12.8 4.266667 17.066667 21.333333 17.066667 36.266666v8.533334c0 4.266667 4.266667 4.266667 8.533333 4.266666 4.266667-23.466667 4.266667-44.8 8.533333-68.266666 0-27.733333 27.733333-53.333333 49.066667-61.866667 8.533333-4.266667 12.8 4.266667 23.466667 0 27.733333-8.533333 93.866667-36.266667 81.066666-72.533333-8.533333-32-36.266667-61.866667-72.533333-57.6-8.533333 4.266667-12.8 8.533333-21.333333 12.8-12.8 8.533333-40.533333 36.266667-53.333334 36.266666-23.466667-4.266667-23.466667-36.266667-17.066666-49.066666 4.266667-17.066667 44.8-76.8 72.533333-66.133334l17.066667 17.066667c8.533333 4.266667 23.466667 4.266667 36.266666 4.266667 4.266667 0 8.533333 0 12.8-4.266667 4.266667-4.266667 4.266667-4.266667 4.266667-8.533333 0-12.8-12.8-27.733333-21.333333-36.266667-8.533333-8.533333-23.466667-17.066667-36.266667-23.466667-44.8-12.8-117.333333 4.266667-151.466667 36.266667s-61.866667 85.333333-81.066666 130.133333c-8.533333 27.733333-17.066667 61.866667-21.333334 93.866667-4.266667 21.333333-8.533333 40.533333 4.266667 61.866667 12.8 27.733333 40.533333 53.333333 68.266667 72.533333 17.066667 12.8 53.333333 12.8 72.533333 36.266667 12.8 17.066667 8.533333 40.533333 8.533333 61.866666 0 27.733333 17.066667 49.066667 27.733334 72.533334 4.266667 12.8 8.533333 32 12.8 44.8 0 4.266667 4.266667 32 4.266666 36.266666 27.733333 12.8 49.066667 27.733333 81.066667 36.266667 4.266667 0 21.333333-27.733333 21.333333-32 12.8-12.8 23.466667-32 36.266667-40.533333 8.533333-4.266667 17.066667-8.533333 27.733333-17.066667 8.533333-8.533333 12.8-27.733333 17.066667-40.533333 2.133333-10.666667 6.4-27.733333 2.133333-40.533334z m8.533334-413.866666c4.266667 0 8.533333-4.266667 17.066666-8.533334 12.8-8.533333 27.733333-23.466667 40.533334-32 12.8-8.533333 27.733333-23.466667 36.266666-32 12.8-8.533333 23.466667-27.733333 27.733334-40.533333 4.266667-8.533333 17.066667-27.733333 12.8-40.533333-4.266667-8.533333-27.733333-12.8-36.266667-17.066667-36.266667-8.533333-66.133333-12.8-102.4-12.8-12.8 0-32 4.266667-36.266667 17.066667-4.266667 23.466667 12.8 17.066667 32 23.466666 0 0 4.266667 36.266667 4.266667 40.533334 4.266667 21.333333-8.533333 36.266667-8.533333 57.6 0 12.8 0 36.266667 8.533333 44.8h4.266667zM891.733333 618.666667c4.266667-8.533333 4.266667-23.466667 8.533334-32 4.266667-21.333333 4.266667-44.8 4.266666-66.133334 0-44.8-4.266667-89.6-17.066666-130.133333-8.533333-12.8-12.8-27.733333-17.066667-40.533333-8.533333-23.466667-21.333333-44.8-40.533333-61.866667-17.066667-23.466667-40.533333-85.333333-81.066667-66.133333-12.8 4.266667-21.333333 21.333333-32 32-8.533333 12.8-17.066667 27.733333-27.733333 40.533333-4.266667 4.266667-8.533333 12.8-4.266667 17.066667 0 4.266667 4.266667 4.266667 8.533333 4.266666 8.533333 4.266667 12.8 4.266667 21.333334 8.533334 4.266667 0 8.533333 4.266667 4.266666 8.533333 0 0 0 4.266667-4.266666 4.266667-21.333333 23.466667-44.8 40.533333-66.133334 61.866666-4.266667 4.266667-8.533333 12.8-8.533333 17.066667 0 4.266667 4.266667 4.266667 4.266667 8.533333s-4.266667 4.266667-8.533334 8.533334c-8.533333 4.266667-17.066667 8.533333-23.466666 12.8-4.266667 8.533333 0 23.466667-4.266667 32-4.266667 23.466667-17.066667 40.533333-27.733333 61.866666-8.533333 12.8-12.8 27.733333-21.333334 40.533334 0 17.066667-4.266667 32 4.266667 44.8 21.333333 32 61.866667 12.8 93.866667 27.733333 8.533333 4.266667 17.066667 4.266667 23.466666 12.8 12.8 12.8 12.8 36.266667 17.066667 49.066667 4.266667 17.066667 8.533333 36.266667 17.066667 53.333333 4.266667 21.333333 12.8 44.8 17.066666 61.866667 40.533333-32 76.8-66.133333 102.4-110.933334 32-27.733333 44.8-64 57.6-100.266666z" fill="#0277BD" /></svg>                    <p><strong>Play Online</strong></p>
                </button>
                <button class="card !bg-secondary-300-600-token p-4 aspect-square flex flex-col justify-center items-center">
                    <svg class="w-8 h-8" viewBox="0 0 1024 1024"><path d="M516.472 946.04c-35.688 0.32-64.872-28.4-65.16-64.088l-1.104-136.856a64.64 64.64 0 0 1 64.12-65.136c35.672-0.28 64.832 28.408 65.144 64.128l1.08 136.824c0.304 35.688-28.408 64.88-64.08 65.128z" fill="#E5226B" /><path d="M938.072 979.992l-842.616 6.792c-35.688 0.28-64.88-28.44-65.16-64.096a64.648 64.648 0 0 1 64.12-65.168l842.648-6.784c35.656-0.28 64.816 28.432 65.128 64.128 0.248 35.688-28.4 64.848-64.12 65.128z" fill="#0092D2" /><path d="M1007.992 650.336c0.384 49.856-39.632 90.592-89.496 91.008L111.2 747.816c-49.856 0.432-90.592-39.704-90.968-89.56L16 134.68c-0.376-49.808 39.664-90.56 89.52-90.96l807.296-6.504c49.856-0.392 90.568 39.696 90.944 89.504l4.232 523.616z" fill="#EF962F" /><path d="M111.2 747.816c-49.856 0.432-90.592-39.704-90.968-89.56L16 134.68c-0.376-49.808 39.664-90.56 89.52-90.96l807.296-6.504" fill="#F4A417" /></svg>
                    <p><strong>Play Against Computer</strong></p>
                </button>
                <button class="card !bg-secondary-300-600-token p-4 aspect-square flex flex-col justify-center items-center">
                    <svg class="w-8 h-8" viewBox="0 0 36 36"><path fill="#78B159" d="M26.093 4.612c-.498.498-.629.839-.728 1.029c-.66 1.266-1.455 1.676-2.78.351c-.13-.13-4.087-4.267-4.741-5.017c-.427-.49-1.081-.64-1.584-.262c-.38.286-4.035 3.273-5.035 4.507c-.774.955-.8 2.134-.079 2.856c.326.326.727.449 1.151.578c.552.169 1.763.068 2.47.775c1.133 1.133.54 2.924-.917 4.421c-1.497 1.457-3.288 2.05-4.421.917c-.708-.708-.606-1.918-.775-2.47c-.129-.424-.252-.824-.578-1.151c-.721-.721-1.9-.694-2.856.079c-1.235 1-4.221 4.655-4.507 5.035c-.379.503-.228 1.156.262 1.584c.75.654 4.887 4.611 5.017 4.741c1.324 1.324.915 2.12-.351 2.78c-.19.099-.53.229-1.029.728a3.744 3.744 0 0 0 5.295 5.295c.498-.498.629-.839.728-1.029c.66-1.266 1.455-1.676 2.78-.351c.13.13 4.087 4.267 4.741 5.017c.427.49 1.081.64 1.584.262c.38-.286 4.035-3.273 5.035-4.507c.774-.955.8-2.134.079-2.856c-.326-.326-.727-.449-1.151-.578c-.552-.169-1.763-.068-2.47-.775c-1.133-1.133-.54-2.924.917-4.421c1.497-1.457 3.288-2.05 4.421-.917c.708.708.606 1.918.775 2.47c.129.424.252.824.578 1.151c.721.721 1.9.694 2.856-.079c1.235-1 4.221-4.655 4.507-5.035c.379-.503.228-1.156-.262-1.584c-.75-.654-4.887-4.611-5.017-4.741c-1.324-1.324-.915-2.12.351-2.78c.19-.099.53-.229 1.029-.728a3.744 3.744 0 0 0-5.295-5.295z"></path></svg>
                    <p><strong>Play Random Puzzles</strong></p>
                </button>
                <button class="card !bg-primary-300-600-token p-4 aspect-square flex flex-col justify-center items-center">
                    <svg class="w-8 h-8" viewBox="0 0 512 512"><path style="fill:#FF7058;" d="M493.714,274.286h-76.617c-14.069,0-22.857-15.264-15.837-27.427 c11.52-19.955-2.589-45.716-26.403-45.716c-23.836,0-37.914,25.778-26.403,45.716c7.034,12.187-1.793,27.427-15.837,27.427H256 c-10.099,0-18.286-8.187-18.286-18.286v-52.003c-37.291,3.428-73.143-25.595-73.143-66.854c0-41.305,35.907-70.281,73.143-66.854 V18.286C237.714,8.187,245.901,0,256,0h237.714C503.813,0,512,8.187,512,18.286V256C512,266.099,503.813,274.286,493.714,274.286z" /> <path style="fill:#F1543F;" d="M493.714,0H374.857v201.143c23.814,0,37.923,25.761,26.403,45.716 c-7.02,12.164,1.768,27.427,15.837,27.427h76.617c10.099,0,18.286-8.187,18.286-18.286V18.286C512,8.187,503.813,0,493.714,0z"/> <path style="fill:#FEE856;" d="M137.143,347.429c-41.217,0-70.281-35.812-66.854-73.143H18.286C8.187,274.286,0,266.099,0,256 V18.286C0,8.187,8.187,0,18.286,0H256c10.099,0,18.286,8.187,18.286,18.286v76.617c0,14.069-15.265,22.86-27.427,15.837 c-19.961-11.522-45.716,2.595-45.716,26.403c0,23.89,25.817,37.889,45.716,26.403c12.187-7.034,27.427,1.792,27.427,15.837V256 c0,10.099-8.187,18.286-18.286,18.286h-52.003C207.404,311.434,178.548,347.429,137.143,347.429z"/> <path style="fill:#FFCE3E;" d="M246.858,110.74c12.162,7.023,27.427-1.768,27.427-15.837V18.286C274.286,8.187,266.099,0,256,0 H137.143v347.429c41.405,0,70.261-35.994,66.854-73.143H256c10.099,0,18.286-8.187,18.286-18.286v-76.617 c0-14.045-15.241-22.869-27.427-15.837c-19.899,11.486-45.716-2.514-45.716-26.403C201.143,113.335,226.898,99.217,246.858,110.74z" /> <path style="fill:#4CDBC4;" d="M256,512H18.286C8.187,512,0,503.813,0,493.714V256c0-10.099,8.187-18.286,18.286-18.286h76.617 c14.068,0,22.858,15.264,15.837,27.427c-11.522,19.961,2.595,45.716,26.403,45.716c23.886,0,37.89-25.815,26.403-45.714 c-7.034-12.186,1.792-27.429,15.837-27.429H256c10.099,0,18.286,8.187,18.286,18.286v51.99 c37.305-3.415,73.143,25.595,73.143,66.854c0,41.294-35.891,70.276-73.143,66.855v52.016C274.286,503.813,266.099,512,256,512z"/> <path style="fill:#5AC2AD;" d="M274.286,307.99V256c0-10.099-8.187-18.286-18.286-18.286h-76.617 c-14.045,0-22.871,15.243-15.837,27.429c11.487,19.9-2.517,45.714-26.403,45.714V512H256c10.099,0,18.286-8.187,18.286-18.286V441.7 c37.252,3.421,73.143-25.561,73.143-66.855C347.429,333.586,311.591,304.575,274.286,307.99z"/> <path style="fill:#84DBFF;" d="M493.714,512H256c-10.099,0-18.286-8.187-18.286-18.286v-76.629c0-14.069,15.265-22.86,27.427-15.837 c19.956,11.516,45.716-2.589,45.716-26.405c0-23.834-25.778-37.912-45.716-26.403c-12.186,7.033-27.427-1.79-27.427-15.835V256 c0-10.099,8.187-18.286,18.286-18.286h52.002c-3.418-37.281,25.576-73.143,66.855-73.143c41.295,0,70.273,35.888,66.855,73.143 h52.002c10.099,0,18.286,8.187,18.286,18.286v237.714C512,503.813,503.813,512,493.714,512z"/> <path style="fill:#54C9EB;" d="M493.714,237.714h-52.002c3.418-37.255-25.56-73.143-66.855-73.143V512h118.857 c10.099,0,18.286-8.187,18.286-18.286V256C512,245.901,503.813,237.714,493.714,237.714z"/></svg>
                    <p><strong>Play Puzzle Mania</strong></p>
                </button>
            </div>
        </div>
        <div class="flex flex-col gap-2 items-center">
            <h2>Recent Games</h2>
            <div class="flex flex-col gap-1">
                {#each data.chessGames.slice(0, 5) as chessGame, i}
                {@const chessStateStore = createOnlineChessStateStore(chessGame, getPlayingColor(chessGame, $page.data.session))}
                {@const chessState = get(chessStateStore)}
                <a class="card {i%2===0 ? "!bg-secondary-800" : "!bg-secondary-900"} p-2 flex gap-8 justify-between" href="/games/{chessGame.id}">
                    <p>{chessState.chess.header()['White']} VS {chessState.chess.header()['Black']}</p>
                    {#if chessState.chess.header()['Result']==='*'}
                        <p>~</p>
                    {:else if chessState.chess.header()['Result']==='1-0' && chessState.playingColor==='w'}
                        <span class="badge variant-ghost-success">{chessState.chess.header()['Result']}</span>
                    {:else if chessState.chess.header()['Result']==='1-0' && chessState.playingColor==='b'}
                        <span class="badge variant-ghost-error">{chessState.chess.header()['Result']}</span>
                    {:else if chessState.chess.header()['Result']==='0-1' && chessState.playingColor==='b'}
                        <span class="badge variant-ghost-success">{chessState.chess.header()['Result']}</span>
                    {/if}
                </a>
            {/each}
            </div>

        </div>
    </div>  

</div>
